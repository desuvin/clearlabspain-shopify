{% comment %} {{ 'custom.css' | asset_url | stylesheet_tag }}
{{ 'swatch.css' | asset_url | stylesheet_tag }}
{{ 'promo-box-new.css' | asset_url | stylesheet_tag }}
{{ 'card-product-new.css' | asset_url | stylesheet_tag }}
{{ 'share.css' | asset_url | stylesheet_tag }}
 {% endcomment %}
<div>
              {% for tag in product.tags %}
                    {% assign checktag = tag  %}
              {% endfor %}       

  <!-- {{ checktag }} -->
  <!-- {{ product.metafields.product.color_swatches.value }} -->
  
  <div class="color-container">
    <div class="product-form__input product-form__input--dropdown">
      <label class="form__label" for="product-color">Color</label>
      <div class="select">
        <select id="product-color" class="select__select" onchange="getVariantID();">
          {% for variant in product.variants %}
             <!-- <option value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}selected{% endif %}>
              {{ variant.title }} {% if variant.available %} {% else %} - Sold Out {% endif %}
            </option> -->
            <option value="{{ variant.title }}" {% if variant == product.selected_or_first_available_variant %}selected{% endif %}>
              {{ variant.title }} {% if variant.available %} {% else %} - Sold Out {% endif %}
            </option>
          {% endfor %}
        </select>
        <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 6">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor">
          </path>
        </svg>
      </div>
      
    </div>
    <!-- <input  type="hidden" value="" id="product-color"> -->
    
  </div>
  <div class="power-container">
    <div class="product-form__input product-form__input--dropdown">
      <label class="form__label" for="product-color">Power</label>
      <div class="select">
        {% assign sorted_products = '' %}

        {% case checktag %}
          {% when "multi-colorlens" %}
            {% for cproduct in collections['multilens-color-lens'].products %}
              {% assign metafield_value = cproduct.metafields.custom.power | default: 'zzzzz' %}
              {% assign sorted_products = sorted_products | append: metafield_value | append: '|' | append: cproduct.handle | append: ',' %}
            {% endfor %}
          {% when "multi-party" %}
            {% for cproduct in collections['multilens-party'].products %}
              {% assign metafield_value = cproduct.metafields.custom.power | default: 'zzzzz' %}
              {% assign sorted_products = sorted_products | append: metafield_value | append: '|' | append: cproduct.handle | append: ',' %}
            {% endfor %}
          {% when "ando-colorlens" %}
            {% for cproduct in collections['white-light-colors'].products %}
              {% assign metafield_value = cproduct.metafields.custom.power | default: 'zzzzz' %}
              {% assign sorted_products = sorted_products | append: metafield_value | append: '|' | append: cproduct.handle | append: ',' %}
            {% endfor %}
          {% when "cc1d-phantom" %}
              {% for cproduct in collections['clearcolor-1-day-phantom'].products %}
                {% assign metafield_value = cproduct.metafields.custom.power | default: 'zzzzz' %}
                {% assign sorted_products = sorted_products | append: metafield_value | append: '|' | append: cproduct.handle | append: ',' %}
              {% endfor %}
          {% when "clear-color-1day" %}
              {% for cproduct in collections['clearcolor-1-day'].products %}
                {% assign metafield_value = cproduct.metafields.custom.power | default: 'zzzzz' %}
                {% assign sorted_products = sorted_products | append: metafield_value | append: '|' | append: cproduct.handle | append: ',' %}
              {% endfor %}
          {% when "clear-color" %}
              {% for cproduct in collections['clearcolor'].products %}
                {% assign metafield_value = cproduct.metafields.custom.power | default: 'zzzzz' %}
                {% assign sorted_products = sorted_products | append: metafield_value | append: '|' | append: cproduct.handle | append: ',' %}
              {% endfor %}
          {% when "clear-color-phantom" %}
              {% for cproduct in collections['clearcolor-phantom'].products %}
                {% assign metafield_value = cproduct.metafields.custom.power | default: 'zzzzz' %}
                {% assign sorted_products = sorted_products | append: metafield_value | append: '|' | append: cproduct.handle | append: ',' %}
              {% endfor %}
          {% when "clear-color-14.2" %}
              {% for cproduct in collections['clearcolor-14-2'].products %}
                {% assign metafield_value = cproduct.metafields.custom.power | default: 'zzzzz' %}
                {% assign sorted_products = sorted_products | append: metafield_value | append: '|' | append: cproduct.handle | append: ',' %}
              {% endfor %}
          {% when "clear-color-55" %}
              {% for cproduct in collections['clearcolor-55'].products %}
                {% assign metafield_value = cproduct.metafields.custom.power | default: 'zzzzz' %}
                {% assign sorted_products = sorted_products | append: metafield_value | append: '|' | append: cproduct.handle | append: ',' %}
              {% endfor %}
        {% endcase %}
        
        {% assign sorted_products = sorted_products | split: ',' %}
        {% assign sorted_products = sorted_products | sort %}
        
        <select class="product-selector select__select" id="product-selector" onchange="getVariantID();">
            {% if sorted_products.size > 0 %}
              {% for sorted_product in sorted_products %}
                {% assign product_data = sorted_product | split: '|' %}
                {% assign product_power = product_data[0] %}
                {% assign product_handle = product_data[1] %}
                
                {% if product_handle != '' and product_power != 'zzzzz' %}
                  {% assign cproduct = collections['multilens-color-lens'].products | where: 'handle', product_handle | first %}
                  <option value="{{ product_handle }}" {% if product_power == "00.00" %} selected {% endif %}>{{ product_power }}</option>
                {% endif %}
              {% endfor %}
            {% else %}
              <option disabled selected>No Power</option>
            {% endif %}
        </select>

        <!-- <select class="product-selector select__select" id="product-selector" onchange="getVariantID();">
            {% case checktag %}
              {% when "multi-colorlens" %}
                {% for cproduct in collections['multilens-color-lens'].products %}
                  <option value="{{ cproduct.handle }}" {% if cproduct.metafields.custom.power == "00.00" %} selected {% endif %}>{{ cproduct.metafields.custom.power }}</option>
                {% endfor %}
              {% when "multi-party" %}
                {% for cproduct in collections['multilens-party'].products %}
                  <option value="{{ cproduct.handle }}" {% if cproduct.metafields.custom.power == "00.00" %} selected {% endif %}>{{ cproduct.metafields.custom.power }}</option>
                {% endfor %}
              {% else %}
                <option disabled selected>No Power</option>
            {% endcase %}
        </select> -->
        

        <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 6">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor">
          </path>
        </svg>
      </div>
    </div>
  </div>
  <div class="quantity-container">
    <div class="product-form__input product-form__quantity">
      <label class="quantity__label form__label" for="Quantity-template--15979220992083__main">Quantity<span class="quantity__rules-cart hidden">
        <div class="loading__spinner hidden">
          <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
            <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
          </svg>
        </div>
        <span>(<span class="quantity-cart">0</span> in cart)</span>
                    </span>
                  </label>
                  <div class="price-per-item__container">
                    <quantity-input class="quantity" data-url="/products/multilens-color-2s-power-1-00" data-section="template--15979220992083__main">
                      <button class="quantity__button disabled" name="minus" type="button">
                        <span class="visually-hidden">Decrease quantity for Multilens Color 2&amp;#39;s, Power +1.00</span>
                        <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" class="icon icon-minus" fill="none" viewBox="0 0 10 2">
                          <path fill-rule="evenodd" clip-rule="evenodd" d="M.5 1C.5.7.7.5 1 .5h8a.5.5 0 110 1H1A.5.5 0 01.5 1z" fill="currentColor">
                          </path>
                        </svg>

                      </button>
                      <input class="quantity__input" type="number" name="quantity" id="product-quantity" data-cart-quantity="0" data-min="1" min="1" step="1" value="1" form="product-form-template--15979220992083__main">
                      <button class="quantity__button" name="plus" type="button">
                        <span class="visually-hidden">Increase quantity for Multilens Color 2&amp;#39;s, Power +1.00</span>
                        <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" class="icon icon-plus" fill="none" viewBox="0 0 10 10">
                          <path fill-rule="evenodd" clip-rule="evenodd" d="M1 4.51a.5.5 0 000 1h3.5l.01 3.5a.5.5 0 001-.01V5.5l3.5-.01a.5.5 0 00-.01-1H5.5L5.49.99a.5.5 0 00-1 .01v3.5l-3.5.01H1z" fill="currentColor">
                        </path></svg>

                      </button>
                    </quantity-input>
                  </div>
                  <div class="quantity__rules caption" id="Quantity-Rules-template--15979220992083__main"></div></div>
    <!-- <input  type="number" value="" id="product-quantity"> -->
  </div>
  <div class="buy-button-container">
    <button id="add-to-cart-button" name="add" class="product-form__submit button button--full-width collection-button2" style="cursor: pointer;">
       <!-- {%- render 'icon-cart-new' -%} -->
       <span>Add to cart</span>
        <div class="loading-overlay__spinner hidden">
          <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
            <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
          </svg>
        </div>
      </button>
  </div>
   
    
    
  <!-- <form id="add-to-cart-form" action="/cart/add" method="post"> -->
  <!-- Left Item -->
  <input type="hidden" name="id" value="" id="input_variant">
  <input  type="hidden"  name="quantity" value="0" id="input_qty_left">

  <!-- Right Item -->
  <input  type="hidden" name="id" value="" id="input_variant_right">
  <input  type="hidden" name="quantity" value="0" id="input_qty_right">
<!-- </form> -->
</div>
<script>
     window.onload = function() {
      var e = document.getElementById("product-selector");
      var handlevalue = e.value;
      console.log(handlevalue);
      getVariantID();
      
      document.getElementById('add-to-cart-button').addEventListener('click', function(e) {
        e.preventDefault();
        var productColor = document.getElementById('product-color').value;
        if (productColor === '') {
          alert('Please select a color');
        } else {
          
          submitForm();
        }
      });

    }

    function getQuantity(id, selValue){
      document.getElementById(id).value = selValue;
    }
    function submitForm(){     
      // console.log("Inside Submit Form");
      variant = document.getElementById('input_variant').value;
      quantity = document.getElementById('product-quantity').value;
      // alert("variant "+variant);
      // alert("qtyLeft"+quantity);
      let formData = {
       'items': [{
        'id': variant,
        'quantity': quantity
        }]
      };
      // console.log(formData);
      
      fetch(window.Shopify.routes.root + 'cart/add.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      })
      .then(response => {
        console.log(response.json())
        if(response.ok){
          // alert('Item(s) added to cart');
          window.location.href = "https://clearlab-spain.myshopify.com/cart";
        }
        // return response.json();
      })
      .catch((error) => {
        console.error('Error:', error);
      });

    }
  
    function getVariantID(){
      var variantId = '';
      var countCombination = 0;
      var productSelector = document.getElementById('product-selector').value;
      var productColor = document.getElementById('product-color').value;
      if(productColor == ''){
        alert('Please select a color');
      } else {
        fetch(window.Shopify.routes.root + 'products/' + productSelector + '.js').then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(product => {
            console.log(product);
            pVariants = product.variants;
            pVariants.forEach((variant) => {
              // Cylinder = option1, Axis = option2
              if (variant.option1 == productColor) {
                variantId = variant.id;
                countCombination++;
              }
            });
        
            if (countCombination > 0) {
              document.getElementById('input_variant').value = variantId;
            } else {
              alert('That Product Combination is not available!');
            }
          })
          .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
          });
         
      }
      
      
    }
</script>
